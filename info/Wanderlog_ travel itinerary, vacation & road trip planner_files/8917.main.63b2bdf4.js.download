"use strict";(self.__LOADABLE_LOADED_CHUNKS__=self.__LOADABLE_LOADED_CHUNKS__||[]).push([[8917],{28917:function(e,t,n){var r=n(58168),a=n(364467),o=n(310467),i=n(3453),l=n(333031),c=n.n(l),s=n(778291),u=n(296540),d=n(916756),p=n(795093),m=n.n(p),f=n(496776),g=n(307521),y=n(616041),v=n(33733),P=n(738067),A=n(476098),b=n(158956),E=n(709638),k=n(741411),S=n(516506),O=n(651954),h=n(881694),w=n(308376),D=n(968483),T=n(274522),C=n(20987);function N(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function j(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?N(Object(n),!0).forEach((function(t){(0,a.A)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):N(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var K=(0,d.PA)((function(e){var t=(0,s.Bd)().t,n=e.placeId,a=e.text,l=e.mapsPlaceId,c=e.buttonClassName,d=e.size,p=e.label,m=(0,y.nc)(),w=m.showLoginModal,N=m.user,K=(0,h.Be)(),I=K.data,B=K.setValue,F=I.lastSaveToDocInfo,M=(0,T.AE)().datePreference,_=(0,u.useState)(!1),L=(0,i.A)(_,2),J=L[0],R=L[1],U=(0,u.useState)(null),z=(0,i.A)(U,2),H=z[0],G=z[1],W=(0,D.D)((function(){(0,E.sx)(b.J.clickSaveToDocButton),w("register",{loginFormWhyText:{login:t("Log in to save places to your own trip plan"),register:t("Sign up to save places to your own trip plan")}})}),[w,t]),X=(0,S.IR)(P.z4),Q=X.state,V=X.call,Y=(0,S.IR)((0,D.D)(function(){var e=(0,o.A)(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,(0,P.N1)(t,M);case 3:return n=e.sent,e.abrupt("return",n);case 7:throw e.prev=7,e.t0=e.catch(0),G(null),B("lastSaveToDocInfo",void 0),e.t0;case 12:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t){return e.apply(this,arguments)}}(),[M,B])),q=Y.state,Z=Y.call,$=(0,D.D)((function(e){Z(e),G(e)}),[Z]),ee=(0,u.useState)({adding:!1,addedKey:null}),te=(0,i.A)(ee,2),ne=te[0],re=te[1],ae=(0,u.useMemo)((function(){if("done"===(null==Q?void 0:Q.status)){var e=Q.result.find((function(e){return e.key===H}));if(e)return e.title}else if((null==F?void 0:F.tripPlanKey)===H)return F.tripPlanTitle;return null}),[F,H,Q]),oe=(0,D.D)(function(){var e=(0,o.A)(regeneratorRuntime.mark((function e(t){var r,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(H){e.next=2;break}return e.abrupt("return");case 2:return r=H,e.prev=3,re({adding:!0,addedKey:null}),(0,E.sx)(b.J.saveToDoc,{placeId:n,key:r}),B("lastSaveToDocInfo",{tripPlanKey:r,tripPlanTitle:ae,sectionId:t}),e.next=9,(0,k.vS)(n);case 9:return o=e.sent,e.next=12,(0,P.UM)({key:r,sectionId:t,place:o,text:a});case 12:re({adding:!1,addedKey:r}),e.next=19;break;case 15:e.prev=15,e.t0=e.catch(3),re({adding:!1,addedKey:null}),(0,A.oR)({text:e.t0.message,color:A.TS.danger});case 19:case"end":return e.stop()}}),e,null,[[3,15]])})));return function(t){return e.apply(this,arguments)}}(),[n,H,ae,B,a]),ie=(0,D.D)((function(){G(null),B("lastSaveToDocInfo",void 0)}),[B]),le=(0,D.D)((function(){var e=!J;if(R(e),e){if(F){var t=F.tripPlanKey;G(t),Z(t)}else G(null);V(),(0,E.sx)(b.J.clickSaveToDocButton)}}),[J,F,Z,V]),ce=ne.adding,se=ne.addedKey,ue=(0,u.useMemo)((function(){var e=!!se;return{label:ce?u.createElement("span",{className:"sr-only"},t("Adding",{translationNote:"Shown when adding something to document is in progress"})):u.createElement("span",null,e?t("Saved",{translationNote:"Successfully saved changes"}):t("Save",{translationNote:"Save changes made"})),color:e?"gray":"dark",faIcon:e?g.G0:f.G0}}),[se,ce,t]),de=(0,u.useMemo)((function(){return j(j({},ue),{},{size:d,label:void 0!==p?p:ue.label})}),[ue,p,d]),pe=(0,u.useMemo)((function(){if(null===H)return null===Q||"inProgress"===Q.status?{mode:v.a.loading}:"error"===Q.status?{mode:v.a.error,message:Q.error}:x({tripPlansState:Q,loadingSectionsForKey:null});if(null===q||"inProgress"===q.status)return"done"===(null==Q?void 0:Q.status)?x({tripPlansState:Q,loadingSectionsForKey:H}):{mode:v.a.loading};if("error"===q.status)return{mode:v.a.error,message:q.error};var e=q.result.filter((function(e){return e.type===C.gX.normal})),t=F&&e.find((function(e){return e.id===F.sectionId}))||null;return{mode:v.a.sections,recentSection:t,tripPlanTitle:ae,sections:e,adding:ne.adding}}),[ne.adding,F,H,ae,q,Q]);return N?u.createElement("div",{className:"d-flex"},u.createElement(v.A,(0,r.A)({},de,{buttonClassName:c,isOpen:J,toggle:le,dropdownState:pe,onTripPlanClick:$,mapsPlaceId:l,onSectionClick:oe,onBackClick:ie,openTripPlanKey:se}))):u.createElement(O.Ay,(0,r.A)({},de,{className:c,onClick:W,clickEvent:b.J.openLoginModal}))}));function x(e){var t=e.tripPlansState,n=e.loadingSectionsForKey,r=c()(t.result,(function(e){return-m()(e.editedAt).unix()})).filter((function(e){return e.keyType===w.Aj.edit})).slice(0,15);return{mode:v.a.tripPlans,tripPlans:r,loadingSectionsForKey:n}}t.A=K},33733:function(e,t,n){n.d(t,{a:function(){return r}});var r,a=n(364467),o=n(58168),i=n(180045),l=n(778291),c=n(296540),s=n(552801),u=n(925630),d=n(66014),p=n(981021),m=n(912298),f=n(328045),g=n(374350),y=n(249922),v=n(20987),P=n(654332),A=n(692840),b=n(651954),E=n(158956),k=n(290667),S=n(520673),O=n(243856),h=n(752301),w=n(569620),D=n(741767),T=n(577180),C=["buttonClassName","isOpen","toggle","dropdownState","onTripPlanClick","mapsPlaceId","onSectionClick","onBackClick","openTripPlanKey"];function N(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function j(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?N(Object(n),!0).forEach((function(t){(0,a.A)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):N(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}!function(e){e.loading="loading",e.error="error",e.tripPlans="tripPlans",e.sections="sections"}(r||(r={}));var K=c.memo((function(e){var t=(0,l.Bd)().t,n=e.buttonClassName,a=e.isOpen,N=e.toggle,K=e.dropdownState,I=e.onTripPlanClick,B=e.mapsPlaceId,F=e.onSectionClick,M=e.onBackClick,_=e.openTripPlanKey,L=(0,i.A)(e,C),J=(0,k.j)(I),R=(0,k.j)(F),U=(0,c.useCallback)((function(e){return e.filter((function(e){return e.type!==v.gX.textOnly})).map((function(e){return c.createElement(s.A,{key:e.id,onClick:R(e.id)},c.createElement("span",{className:"mr-2",style:{color:e.placeMarkerColor}},c.createElement(P.A,{icon:m.Pc})),e.displayHeading||c.createElement("em",null,t("Untitled section",{translationNote:"Title used for a section of a document without a title"})))}))}),[R,t]);(0,w.S)(a?2e3:0);var z,H=(0,c.useMemo)((function(){return{openTripPlanKey:_}}),[_]);return z=_?c.createElement(D.A,(0,o.A)({},L,{label:t("Open trip",{translationNote:"Access itinerary information"}),faIcon:void 0,clickEvent:E.J.clickOpenTripOnSaveToDocButton,eventProperties:H,to:(0,T.mC)({key:_,title:null}),onCaretClick:N,caretClickEvent:E.J.clickSaveToDocButton,stopPropagation:!1})):c.createElement(u.A,{tag:"div"},c.createElement(b.Ay,(0,o.A)({},L,{loading:K.mode===r.sections&&K.adding,clickEvent:E.J.clickSaveToDocButton,onClick:x,className:n}))),c.createElement(d.A,{direction:"down",isOpen:a,toggle:N},z,c.createElement(A.A,{flip:!0,right:!0,positionFixed:!0,container:"body",modifiers:j(j({},S.f),{},{preventOverflow:{boundariesElement:"viewport"}})},K.mode===r.error?c.createElement(s.A,{header:!0},c.createElement("span",{className:"text-danger"},t("Error: {{errorMessage}}",{translationNote:"Mistake that's occurred",errorMessage:K.message}))):K.mode===r.loading?c.createElement(s.A,{header:!0},c.createElement("span",{className:"mr-2"},c.createElement(y.A,null)),t("Loadingâ€¦",{translationNote:"Indicates content is currently being loaded"})):K.mode===r.sections?c.createElement(c.Fragment,null,c.createElement(s.A,{onClick:M,toggle:!1,className:"font-weight-bold py-2"},c.createElement(P.A,{icon:p.Ce,className:"mr-2"}),t("Back",{translationNote:"For navigating back to previous page"})),c.createElement(s.A,{divider:!0}),K.recentSection&&c.createElement(c.Fragment,null,c.createElement(s.A,{header:!0},t("Recently saved to")),U([K.recentSection]),c.createElement(s.A,{divider:!0})),c.createElement(s.A,{header:!0},K.tripPlanTitle?t("Sections of {{tripPlanTitle}}",{tripPlanTitle:K.tripPlanTitle}):t("Sections",{translationNote:"Sections of a trip plan document"})),U(K.sections)):c.createElement(c.Fragment,null,c.createElement(s.A,{tag:g.A,to:(0,h.Wm)({type:O.J.plan,mapPlaceId:B||void 0}),className:"font-weight-bold py-2"},c.createElement("span",{className:"mr-2"},c.createElement(P.A,{icon:f.QL})),t("Create a new plan")),c.createElement(s.A,{divider:!0}),0!==K.tripPlans.length?K.tripPlans.map((function(e){return c.createElement(s.A,{key:e.key,onClick:J(e.key),toggle:!1,disabled:null!==K.loadingSectionsForKey},e.title," ",K.loadingSectionsForKey===e.key&&c.createElement(y.A,{className:"ml-2"}))})):c.createElement(s.A,{disabled:!0},t("You don't have any plans or guides yet")))))})),x=function(){};t.A=K}}]);